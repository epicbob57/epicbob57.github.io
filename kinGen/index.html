<!DOCTYPE html>
<html>
<head>
<title>Kindle Genesis</title>
<script type="text/javascript">
function dlSearch(text) {
    
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState == XMLHttpRequest.DONE) {
            parseSearch(JSON.parse(this.responseText).body);
        }   
    }
    xhr.open("GET", "http://cors-proxy.htmldriven.com/?url=http://gen.lib.rus.ec/foreignfiction/index.php?s="+encodeURIComponent(text),true);
    xhr.send(null);
}
function parseSearch(html){
    var resRgx = /<td>Title:<\/td><td>([\s\S]+)<\/td>[\s\S]+?<a href="\/foreignfiction\/ads\.php\?md5=(\w+)"/g;
    match = resRgx.exec(html);
    var md5_a = [];
    var title_a = [];
    while (match != null) {
        title_a.push(match[1]);
        md5_a.push(match[2]);
        match = resRgx.exec(html);
    }
    console.log(md5_a);
    console.log(title_a);
}
function convert(url) {
var data = JSON.stringify({
    "input": [
        {
            "type": "remote",
            "source": url
        }
    ],
    "conversion": [
        {
            "category": "ebook",
            "target": "mobi"
        }
    ]
});

var xhr = new XMLHttpRequest();
xhr.withCredentials = true;

xhr.addEventListener("readystatechange", function () {
    //if (this.readyState === 4) {
        console.log(this.responseText);
    //}
});

xhr.open("POST", "http://api2.online-convert.com/jobs");
xhr.setRequestHeader("x-oc-api-key", "52c5f7f870448df3993d1f5dc51a580a");
xhr.setRequestHeader("content-type", "application/json");
xhr.setRequestHeader("cache-control", "no-cache");

xhr.send(data);
console.log(xhr);
}
</script>
</head>

<body>
<h1>Kindle Genesis</h1>
<input id="sText" type="text" placeholder="Search LibGen..."></input>
    <button onclick="dlSearch(document.getElementById('sText').value);">Search</button>
</body>
</html>
